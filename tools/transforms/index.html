<script src="https://aframe.io/releases/0.8.2/aframe.min.js"></script>
<script src="https://unpkg.com/aframe-environment-component@1.0.0/dist/aframe-environment-component.min.js"></script>

<style>
  label,
  p {
    color: #FD77B6;
  }
  span {
    color: #82EEE1;
  }
  #sidebar {
    background: #444;
    border-right: 1px solid #82EEE1;
    color: #FAFAFA;
    font-family: monospace;
    height: 100%;
    left: 0;
    padding: 20px;
    position: fixed;
    text-transform: uppercase;
    top: 0;
    width: 40%;
    z-index: 99999;
  }
  div {
    margin-bottom: 10px;
  }
  #inputDiv {
    border-bottom: 1px solid #DDD;
    padding-bottom: 10px;
  }
  #worldInfoDiv {
    padding-top : 5px;
  }
  .parent {
    padding-left: 30px
  }
  .child {
    padding-left: 60px
  }
  a-scene {
    height: 100%;
    position: fixed;
    right: 0;
    top: 0;
    width: 60%;
  }
</style>

<a-scene embedded="true">
  <a-entity environment="preset: forest; shadow: true" position="0 -3 0"></a-entity>
  <a-light position="-1 0 -1"></a-light>
  <a-light position="1 0 -0.5" intensity="0.65"></a-light>
  <a-light position="0.25 0 1" intensity="0.25"></a-light>

  <a-camera position="0 0.75 4"></a-camera>

  <a-entity id="grandparent" shadow>
    <a-entity id="parent">
      <a-box id="child" color="#DF2935"></a-box>
    </a-entity>
  </a-entity>
</a-scene>

<div id="sidebar">
  <h1>Transform Visualizer</h1>
  <div id="inputDiv"></div>
  <div id="worldInfoDiv"></div>
</div>

<script>
  var grandparent = document.querySelector('#grandparent');
  var parent = document.querySelector('#parent');
  var child = document.querySelector('#child');

  var inputDiv = document.getElementById('inputDiv');
  var worldInfoDiv = document.getElementById('worldInfoDiv');

  var targets = [grandparent, parent, child];
  var transforms = ['rotation', 'scale'];
  var axes = ['x', 'y', 'z'];

  targets.forEach(target => {
    var targetDiv = document.createElement('div');
    targetDiv.classList.add(target.id);
    inputDiv.appendChild(targetDiv);

    transforms.forEach(transform => {
      // Create world info.
      var worldInfoWrapper = document.createElement('p');
      worldInfoWrapper.classList.add(target.id);
      worldInfoWrapper.innerHTML = `${target.id} World ${transform}: `;
      var worldInfo = document.createElement('span');
      worldInfo .innerHTML = `${transform === 'rotation' ? '0 0 0' : '1 1 1'}`;
      worldInfoWrapper.appendChild(worldInfo);
      worldInfoDiv.appendChild(worldInfoWrapper);

      axes.forEach(axis => {
        // Create label.
        var label = document.createElement('label');
        label.innerHTML = `${target.id} ${transform} ${axis}`;
        targetDiv.appendChild(label);

        // Create input.
        var input = document.createElement('input');
        input.setAttribute('type', 'range');
        input.setAttribute('min', transform === 'rotation' ? -180 : 0.5);
        input.setAttribute('max', transform === 'rotation' ? 180 : 2);
        input.setAttribute('step', transform === 'rotation' ? 45 : 0.25);
        input.setAttribute('value', transform === 'rotation' ? 0 : 1);
        targetDiv.appendChild(input);

        // Create info.
        var info = document.createElement('span');
        info.innerHTML = input.value;
        targetDiv.appendChild(info);

        // Add input listener.
        input.addEventListener('input', transform === 'rotation'
          ? rotationListener(target, axis, input, info, worldInfo)
          : scaleListener(target, axis, input, info, worldInfo)
        );

        targetDiv.appendChild(document.createElement('br'));
      });
    });
  });

  function rotationListener (target, axis, input, info, worldInfo) {
    return function () {
      var value = parseFloat(input.value);
      target.object3D.rotation[axis] = THREE.Math.degToRad(value);
      info.innerHTML = value.toFixed(1);
      var eul = new THREE.Euler();
      target.object3D.getWorldRotation(eul);
      worldInfo.innerHTML = `${THREE.Math.radToDeg(eul.x.toFixed(1))} ${THREE.Math.radToDeg(eul.y.toFixed(1))} ${THREE.Math.radToDeg(eul.z.toFixed(1))}`;
    };
  }

  function scaleListener (target, axis, input, info, worldInfo) {
    return function () {
      var value = parseFloat(input.value);
      target.object3D.scale.x = value;
      sInfo.innerHTML = value.toFixed(1);
      var vec = new THREE.Vector3();
      target.object3D.getWorldScale(vec);
      worldInfo.innerHTML = `${vec.x.toFixed(1)} ${vec.y.toFixed(1)} ${vec.z.toFixed(1)}`;
    };
  }
</script>
