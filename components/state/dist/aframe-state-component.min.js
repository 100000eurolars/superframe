!function(t,e){if("object"==typeof exports&&"object"==typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var i=e();for(var s in i)("object"==typeof exports?exports:t)[s]=i[s]}}("undefined"!=typeof self?self:this,function(){return function(t){function e(s){if(i[s])return i[s].exports;var n=i[s]={i:s,l:!1,exports:{}};return t[s].call(n.exports,n,n.exports,e),n.l=!0,n.exports}var i={};return e.m=t,e.c=i,e.d=function(t,i,s){e.o(t,i)||Object.defineProperty(t,i,{configurable:!1,enumerable:!0,get:s})},e.n=function(t){var i=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(i,"a",i),i},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=0)}([function(t,e,i){"use strict";function s(t,e){var i,s,n=t;for(s=e.split("."),i=0;i<s.length;i++)n=n[s[i]];return s.length=0,n}function n(t){var e;for(e in t)delete t[e]}function o(){var t,e,i,s=arguments;for(i={},e=0;e<s.length;e++)for(t in s[e])t in i?i[t].constructor===Array?i[t].push(s[e][t]):i[t]=[i[t],s[e][t]]:i[t]=s[e][t];for(t in i)i[t].constructor===Array&&(i[t]=a.apply(this,i[t]));return i}function a(){var t=arguments;return function(){var e;for(e=0;e<t.length;e++)t[e].apply(this,arguments)}}function r(t){var e;return e=t.indexOf("."),-1===e?t.trim():t.substring(0,t.indexOf(".")).trim()}var h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},u={initialState:{},handlers:{},computeState:function(){}};AFRAME.registerState=function(t){AFRAME.utils.extend(u,t)},AFRAME.registerSystem("state",{init:function(){var t=this;this.diff={},this.state=AFRAME.utils.clone(u.initialState),this.subscriptions=[],this.initEventHandlers(),this.lastState=AFRAME.utils.clone(this.state),this.eventDetail={lastState:this.lastState,state:this.state},this.el.addEventListener("loaded",function(){var e;for(e=0;e<t.subscriptions.length;e++)t.subscriptions[e].onStateUpdate(t.state,"@@INIT",{})})},dispatch:function(t,e){var i,s;u.handlers[t](this.state,e),u.computeState(this.state);for(s in this.diff)delete this.diff[s];for(AFRAME.utils.diff(this.lastState,this.state,this.diff),this.copyState(this.lastState,this.state),i=0;i<this.subscriptions.length;i++)this.shouldUpdate(this.subscriptions[i].keysToWatch,this.diff)&&this.subscriptions[i].onStateUpdate(this.state,t,e);this.eventDetail.action=t,this.eventDetail.payload=e,this.el.emit("stateupdate",this.eventDetail)},copyState:function(t,e){var i;for(i in e)if(e[i]&&e[i].constructor===Object){if(!(i in t)){t[i]=AFRAME.utils.clone(e[i]);continue}this.copyState(t[i],e[i])}else t[i]=e[i]},subscribe:function(t){this.subscriptions.push(t)},unsubscribe:function(t){this.subscriptions.splice(this.subscriptions.indexOf(t),1)},shouldUpdate:function(t,e){var i;for(i in e)if(-1!==t.indexOf(i))return!0;return!1},initEventHandlers:function(){function t(t){var e=this;this.el.addEventListener(t,function(i){e.dispatch(t,i.detail)})}var e,i=[];t=t.bind(this);for(e in u.handlers)-1===i.indexOf(e)&&(i.push(e),t(e))}}),AFRAME.registerComponent("bind",{schema:{default:{},parse:function(t){var e,i,s,n;if(t.constructor===Object)return t;if(-1===t.indexOf(":"))return t;for(e={},s=t.split(";"),i=0;i<s.length;i++)n=s[i].trim().split(":"),e[n[0]]=n[1].trim();return e}},multiple:!0,init:function(){this.system=this.el.sceneEl.systems.state,this.keysToWatch=[],this.onStateUpdate=this.onStateUpdate.bind(this),this.isNamespacedBind=this.id&&this.id in AFRAME.components&&!AFRAME.components[this.id].isSingleProp||this.id in AFRAME.systems,this.lastData={},this.updateObj={},this.system.subscribe(this),this.onStateUpdate(this.system.state)},update:function(){var t,e=this.data;if(this.keysToWatch.length=0,"string"==typeof e)return void this.keysToWatch.push(r(e));for(t in e)this.keysToWatch.push(r(e[t]))},onStateUpdate:function(t,e){var i,o,a,r=!1,u=this.el;if(this.isNamespacedBind&&n(this.updateObj),"object"!==h(this.data)){try{a=s(t,this.data)}catch(t){throw new Error("[aframe-state-component] Key '"+this.data+"' not found in state. #"+this.el.getAttribute("id")+"["+this.attrName+"]")}if("object "!=typeof a&&"object"!==h(this.lastData)&&this.lastData===a)return;return AFRAME.utils.entity.setComponentProperty(u,this.id,a),void(this.lastData=a)}for(i in this.data){o=this.data[i].trim();try{a=s(t,o)}catch(t){throw new Error("[aframe-state-component] Key '"+o+"' not found in state. #"+this.el.getAttribute("id")+"["+this.attrName+"]")}if("object"===(void 0===a?"undefined":h(a))||"object"===h(this.lastData[i])||this.lastData[i]!==a){if(i in AFRAME.components&&void 0===a)return void u.removeAttribute(i);this.isNamespacedBind?this.updateObj[i]=a:AFRAME.utils.entity.setComponentProperty(u,i,a),this.lastData[i]=a}}for(r in this.updateObj);this.isNamespacedBind&&r&&u.setAttribute(this.id,this.updateObj)},remove:function(){this.system.unsubscribe(this)}}),AFRAME.registerComponent("bind-toggle",{schema:{type:"string"},multiple:!0,init:function(){this.system=this.el.sceneEl.systems.state,this.keysToWatch=[],this.onStateUpdate=this.onStateUpdate.bind(this),this.system.subscribe(this),this.onStateUpdate(this.system.state)},update:function(){this.keysToWatch[0]=r(this.data)},onStateUpdate:function(t,e){var i,n=this.el;try{i=s(t,this.data)}catch(t){throw new Error("[aframe-state-component] Key '"+this.data+"' not found in state. #"+this.el.getAttribute("id")+"["+this.attrName+"]")}i?n.setAttribute(this.id,""):n.removeAttribute(this.id)},remove:function(){this.system.unsubscribe(this)}}),t.exports.composeHandlers=o,t.exports.composeFunctions=a}])});