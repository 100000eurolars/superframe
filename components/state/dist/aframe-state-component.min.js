!function(t,i){if("object"==typeof exports&&"object"==typeof module)module.exports=i();else if("function"==typeof define&&define.amd)define([],i);else{var e=i();for(var s in e)("object"==typeof exports?exports:t)[s]=e[s]}}(this,function(){return function(t){function i(s){if(e[s])return e[s].exports;var n=e[s]={i:s,l:!1,exports:{}};return t[s].call(n.exports,n,n.exports,i),n.l=!0,n.exports}var e={};return i.m=t,i.c=e,i.d=function(t,e,s){i.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:s})},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,i){return Object.prototype.hasOwnProperty.call(t,i)},i.p="",i(i.s=0)}([function(t,i,e){"use strict";function s(t,i){var e,s,n=t;for(s=i.split("."),e=0;e<s.length;e++)n=n[s[e]];return s.length=0,n}function n(t){var i;for(i in t)delete t[i]}function o(){var t,i,e,s=arguments;for(e={},i=0;i<s.length;i++)for(t in s[i])t in e?e[t].constructor===Array?e[t].push(s[i][t]):e[t]=[e[t],s[i][t]]:e[t]=s[i][t];for(t in e)e[t].constructor===Array&&(e[t]=r.apply(this,e[t]));return e}function r(){var t=arguments;return function(){var i;for(i=0;i<t.length;i++)t[i].apply(this,arguments)}}var a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},u={initialState:{},handlers:{},computeState:function(){}};AFRAME.registerState=function(t){AFRAME.utils.extend(u,t)},AFRAME.registerSystem("state",{init:function(){var t=this;this.diff={},this.lastState={},this.state=AFRAME.utils.clone(u.initialState),this.subscriptions=[],this.initEventHandlers(),this.el.addEventListener("loaded",function(){var i;for(i=0;i<t.subscriptions.length;i++)t.subscriptions[i].onStateUpdate(t.state,"@@INIT",{})})},dispatch:function(t,i){var e,s;u.handlers[t](this.state,i),u.computeState(this.state);for(s in this.diff)delete this.diff[s];for(AFRAME.utils.diff(this.state,this.lastState,this.diff),AFRAME.utils.extendDeep(this.lastState,this.state),e=0;e<this.subscriptions.length;e++)this.shouldUpdate(this.subscriptions[e].keysToWatch,this.diff)&&this.subscriptions[e].onStateUpdate(this.state,t,i)},subscribe:function(t){this.subscriptions.push(t)},unsubscribe:function(t){this.subscriptions.splice(this.subscriptions.indexOf(t),1)},shouldUpdate:function(t,i){var e;for(e in i)if(t.indexOf(e))return!0;return!1},initEventHandlers:function(){function t(t){var i=this;this.el.addEventListener(t,function(e){i.dispatch(t,e.detail)})}var i,e=[];t=t.bind(this);for(i in u.handlers)-1===e.indexOf(i)&&(e.push(i),t(i))}}),AFRAME.registerComponent("bind",{schema:{default:{},parse:function(t){var i,e,s,n;if(t.constructor===Object)return t;if(-1===t.indexOf(":"))return t;for(i={},s=t.split(";"),e=0;e<s.length;e++)n=s[e].trim().split(":"),i[n[0]]=n[1];return i}},multiple:!0,init:function(){this.system=this.el.sceneEl.systems.state,this.keysToWatch=[],this.onStateUpdate=this.onStateUpdate.bind(this),this.isNamespacedBind=this.id&&this.id in AFRAME.components&&!AFRAME.components[this.id].isSingleProp||this.id in AFRAME.systems,this.lastData={},this.updateObj={},this.system.subscribe(this)},update:function(){var t,i,e,s=this.data;this.keysToWatch.length=0;for(i in s)e=i,t=s[i].indexOf("."),-1!==t&&(e=s[i].substring(0,s[i].indexOf("."))),this.keysToWatch.push(e)},onStateUpdate:function(t){var i,e,o,r=!1,u=this.el;if(this.isNamespacedBind&&n(this.updateObj),"object"!==a(this.data)){if("object "!=typeof(o=s(t,this.data))&&"object"!==a(this.lastData)&&this.lastData===o)return;return AFRAME.utils.entity.setComponentProperty(u,this.id,o),void(this.lastData=o)}for(i in this.data)if(e=this.data[i].trim(),o=s(t,e),"object"===(void 0===o?"undefined":a(o))||"object"===a(this.lastData[i])||this.lastData[i]!==o){if(i in AFRAME.components&&void 0===o)return void u.removeAttribute(i);this.isNamespacedBind?this.updateObj[i]=o:AFRAME.utils.entity.setComponentProperty(u,i,o),this.lastData[i]=o}for(r in this.updateObj);this.isNamespacedBind&&r&&u.setAttribute(this.id,this.updateObj)},remove:function(){this.system.unsubscribe(this)}}),t.exports.composeHandlers=o,t.exports.composeFunctions=r}])});