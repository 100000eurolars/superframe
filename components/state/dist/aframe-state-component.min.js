!function(t,i){if("object"==typeof exports&&"object"==typeof module)module.exports=i();else if("function"==typeof define&&define.amd)define([],i);else{var e=i();for(var s in e)("object"==typeof exports?exports:t)[s]=e[s]}}(this,function(){return function(t){function i(s){if(e[s])return e[s].exports;var n=e[s]={i:s,l:!1,exports:{}};return t[s].call(n.exports,n,n.exports,i),n.l=!0,n.exports}var e={};return i.m=t,i.c=e,i.d=function(t,e,s){i.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:s})},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,i){return Object.prototype.hasOwnProperty.call(t,i)},i.p="",i(i.s=0)}([function(t,i,e){"use strict";function s(t,i){var e,s,n=t;for(s=i.split("."),e=0;e<s.length;e++)n=n[s[e]];return s.length=0,n}function n(t){var i;for(i in t)delete t[i]}function o(){var t,i,e,s=arguments;for(e={},i=0;i<s.length;i++)for(t in s[i])t in e?e[t].constructor===Array?e[t].push(s[i][t]):e[t]=[e[t],s[i][t]]:e[t]=s[i][t];for(t in e)e[t].constructor===Array&&(e[t]=r.apply(this,e[t]));return e}function r(){var t=arguments;return function(){var i;for(i=0;i<t.length;i++)t[i].apply(this,arguments)}}var a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},u={initialState:{},handlers:{},computeState:function(){}};AFRAME.registerState=function(t){AFRAME.utils.extend(u,t)},AFRAME.registerSystem("state",{init:function(){var t=this;this.diff={},this.state=AFRAME.utils.clone(u.initialState),this.subscriptions=[],this.initEventHandlers(),this.lastState=AFRAME.utils.clone(this.state),this.el.addEventListener("loaded",function(){var i;for(i=0;i<t.subscriptions.length;i++)t.subscriptions[i].onStateUpdate(t.state,"@@INIT",{})})},dispatch:function(t,i){var e,s;u.handlers[t](this.state,i),u.computeState(this.state);for(s in this.diff)delete this.diff[s];for(AFRAME.utils.diff(this.state,this.lastState,this.diff),this.copyState(this.lastState,this.state),e=0;e<this.subscriptions.length;e++)this.shouldUpdate(this.subscriptions[e].keysToWatch,this.diff)&&this.subscriptions[e].onStateUpdate(this.state,t,i)},copyState:function(t,i){var e;for(e in i)i[e]&&a(i[e].constructor)===Object?this.copyState(t[e],i[e]):t[e]=i[e]},subscribe:function(t){this.subscriptions.push(t)},unsubscribe:function(t){this.subscriptions.splice(this.subscriptions.indexOf(t),1)},shouldUpdate:function(t,i){var e;for(e in i)if(-1!==t.indexOf(e))return!0;return!1},initEventHandlers:function(){function t(t){var i=this;this.el.addEventListener(t,function(e){i.dispatch(t,e.detail)})}var i,e=[];t=t.bind(this);for(i in u.handlers)-1===e.indexOf(i)&&(e.push(i),t(i))}}),AFRAME.registerComponent("bind",{schema:{default:{},parse:function(t){var i,e,s,n;if(t.constructor===Object)return t;if(-1===t.indexOf(":"))return t;for(i={},s=t.split(";"),e=0;e<s.length;e++)n=s[e].trim().split(":"),i[n[0]]=n[1].trim();return i}},multiple:!0,init:function(){this.system=this.el.sceneEl.systems.state,this.keysToWatch=[],this.onStateUpdate=this.onStateUpdate.bind(this),this.isNamespacedBind=this.id&&this.id in AFRAME.components&&!AFRAME.components[this.id].isSingleProp||this.id in AFRAME.systems,this.lastData={},this.updateObj={},this.system.subscribe(this)},update:function(){function t(t){var i;return i=t.indexOf("."),-1===i?t.trim():t.substring(0,t.indexOf(".")).trim()}var i,e=this.data;if(this.keysToWatch.length=0,"string"==typeof e)return void this.keysToWatch.push(t(e));for(i in e)this.keysToWatch.push(t(e[i]))},onStateUpdate:function(t,i){var e,o,r,u=!1,c=this.el;if(this.isNamespacedBind&&n(this.updateObj),"object"!==a(this.data)){if("object "!=typeof(r=s(t,this.data))&&"object"!==a(this.lastData)&&this.lastData===r)return;return AFRAME.utils.entity.setComponentProperty(c,this.id,r),void(this.lastData=r)}for(e in this.data)if(o=this.data[e].trim(),r=s(t,o),"object"===(void 0===r?"undefined":a(r))||"object"===a(this.lastData[e])||this.lastData[e]!==r){if(e in AFRAME.components&&void 0===r)return void c.removeAttribute(e);this.isNamespacedBind?this.updateObj[e]=r:AFRAME.utils.entity.setComponentProperty(c,e,r),this.lastData[e]=r}for(u in this.updateObj);this.isNamespacedBind&&u&&c.setAttribute(this.id,this.updateObj)},remove:function(){this.system.unsubscribe(this)}}),t.exports.composeHandlers=o,t.exports.composeFunctions=r}])});